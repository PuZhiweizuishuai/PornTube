import{_,b as w,a as o,f as g,r as t,w as l,o as p,e as c,h as V,c as h,g as D,t as b,u as T}from"./index-TiTfTDly.js";const z={name:"LoginForm",data(){return{verifyImageUrl:"/api/verifyImage",username:"",password:"",verifyCode:"",rememberMe:!1,loading:!1}},methods:{submitLog(){const n=this.username,e=this.password,d=this.verifyCode,u=this.rememberMe,s={username:n,password:e,verifyCode:d,rememberMe:u};n===""||e===""||d===""||(this.loading=!0,this.$emit("login",s),setTimeout(()=>{this.loading=!1},2e3))},getVerifyImage(){this.verifyImageUrl="/api/verifyImage?t="+new Date().getTime()}}},B={class:"d-flex align-center mb-4"},N={class:"d-flex mb-6"},S={class:"text-center"};function A(n,e,d,u,s,a){const i=t("v-text-field"),m=t("v-img"),f=t("v-switch"),v=t("v-btn");return p(),w("div",null,[o(i,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=r=>s.username=r),label:"邮箱或手机号",placeholder:"请输入你的邮箱或手机号",rules:[r=>!!r||"请输入邮箱或手机号"],density:"comfortable",class:"mb-4","prepend-inner-icon":"mdi-email-outline",clearable:""},null,8,["modelValue","rules"]),o(i,{modelValue:s.password,"onUpdate:modelValue":e[1]||(e[1]=r=>s.password=r),label:"密码",placeholder:"密码",rules:[r=>!!r||"密码不能为空"],density:"comfortable",class:"mb-4","prepend-inner-icon":"mdi-lock-outline",type:"password",clearable:""},null,8,["modelValue","rules"]),g("div",B,[o(m,{src:s.verifyImageUrl,alt:"验证码",title:"点击刷新",style:{cursor:"pointer","max-width":"150px",height:"40px","border-radius":"4px"},onClick:a.getVerifyImage,class:"me-3"},null,8,["src","onClick"]),o(i,{modelValue:s.verifyCode,"onUpdate:modelValue":e[2]||(e[2]=r=>s.verifyCode=r),label:"验证码",placeholder:"验证码",rules:[r=>!!r||"验证码不能为空"],density:"comfortable","prepend-inner-icon":"mdi-text-box-check-outline",clearable:""},null,8,["modelValue","rules"])]),g("div",N,[o(f,{modelValue:s.rememberMe,"onUpdate:modelValue":e[3]||(e[3]=r=>s.rememberMe=r),label:"记住我",color:"primary",density:"comfortable","hide-details":""},null,8,["modelValue"])]),g("div",S,[o(v,{color:"primary",size:"large",variant:"elevated",rounded:"lg",loading:s.loading,onClick:a.submitLog,block:""},{default:l(()=>e[4]||(e[4]=[c(" 登录 ")])),_:1},8,["loading","onClick"])])])}const H=_(z,[["render",A]]),P={name:"RegisterFrom",data(){return{verifyImageUrl:"/api/verifyImage",registerUser:{mail:"",phone:"",password:"",invitationCode:"",verifyCode:"",username:""},snackbar:!1,color:"success",message:"分享成功",webInfo:{},loading:!1}},created(){this.webInfo=V().webInfo},methods:{submitRegister(){var n=/^(([^()[\]\\.,;:\s@]+(\.[^()[\]\\.,;:\s@]+)*)|(.+))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!n.test(this.registerUser.mail)){this.message="邮箱格式错误",this.color="error",this.snackbar=!0;return}if(this.registerUser.password===""||this.registerUser.password.length<6||this.registerUser.verifyCode===""||this.registerUser.username===""){this.message="密码不能为空且不能小于6个字符",this.color="error",this.snackbar=!0;return}if(this.webInfo.openInvitationRegister===1&&this.registerUser.invitationCode===""&&this.registerUser.username!=="admin"){this.message="邀请码不能为空",this.color="error",this.snackbar=!0;return}if(this.registerUser.phone!==""){var e=/^[1][3,4,5,7,8][0-9]{9}$/;if(!e.test(this.registerUser.phone)){this.message="手机号码格式错误",this.color="error",this.snackbar=!0;return}}this.loading=!0,this.$emit("register",this.registerUser),setTimeout(()=>{this.loading=!1},2e3)},getVerifyImage(){this.verifyImageUrl="/api/verifyImage?t="+new Date().getTime()}}},Z={class:"d-flex align-center mb-6"},j={class:"text-center"};function q(n,e,d,u,s,a){const i=t("v-text-field"),m=t("v-img"),f=t("v-btn"),v=t("v-snackbar");return p(),w("div",null,[o(i,{modelValue:s.registerUser.mail,"onUpdate:modelValue":e[0]||(e[0]=r=>s.registerUser.mail=r),label:"邮箱",placeholder:"请输入你的邮箱",rules:[r=>!!r||"邮箱不能为空"],type:"email",density:"comfortable",class:"mb-4","prepend-inner-icon":"mdi-email-outline",clearable:""},null,8,["modelValue","rules"]),o(i,{modelValue:s.registerUser.phone,"onUpdate:modelValue":e[1]||(e[1]=r=>s.registerUser.phone=r),label:"手机号",placeholder:"请输入你的手机号（系统原因，此项选填）",density:"comfortable",class:"mb-4","prepend-inner-icon":"mdi-phone-outline",clearable:""},null,8,["modelValue"]),o(i,{modelValue:s.registerUser.username,"onUpdate:modelValue":e[2]||(e[2]=r=>s.registerUser.username=r),label:"昵称",placeholder:"昵称",rules:[r=>!!r||"昵称不能为空"],density:"comfortable",class:"mb-4","prepend-inner-icon":"mdi-account-outline",clearable:""},null,8,["modelValue","rules"]),o(i,{modelValue:s.registerUser.password,"onUpdate:modelValue":e[3]||(e[3]=r=>s.registerUser.password=r),label:"密码",placeholder:"密码",rules:[r=>!!r||"密码不能为空",r=>r&&r.length>=6||"密码长度不能小于6个字符"],density:"comfortable",class:"mb-4","prepend-inner-icon":"mdi-lock-outline",type:"password",clearable:""},null,8,["modelValue","rules"]),s.webInfo.openInvitationRegister==1?(p(),h(i,{key:0,modelValue:s.registerUser.invitationCode,"onUpdate:modelValue":e[4]||(e[4]=r=>s.registerUser.invitationCode=r),label:"邀请码",placeholder:"邀请码",rules:[r=>!!r||"邀请码不能为空"],density:"comfortable",class:"mb-4","prepend-inner-icon":"mdi-ticket-outline",clearable:""},null,8,["modelValue","rules"])):D("",!0),g("div",Z,[o(m,{src:s.verifyImageUrl,alt:"验证码",title:"点击刷新",style:{cursor:"pointer","max-width":"150px",height:"40px","border-radius":"4px"},onClick:a.getVerifyImage,class:"me-3"},null,8,["src","onClick"]),o(i,{modelValue:s.registerUser.verifyCode,"onUpdate:modelValue":e[5]||(e[5]=r=>s.registerUser.verifyCode=r),label:"验证码",placeholder:"验证码",rules:[r=>!!r||"验证码不能为空"],density:"comfortable","prepend-inner-icon":"mdi-text-box-check-outline",clearable:""},null,8,["modelValue","rules"])]),g("div",j,[o(f,{color:"primary",size:"large",variant:"elevated",rounded:"lg",loading:s.loading,onClick:a.submitRegister,block:""},{default:l(()=>e[7]||(e[7]=[c(" 注册 ")])),_:1},8,["loading","onClick"])]),o(v,{modelValue:s.snackbar,"onUpdate:modelValue":e[6]||(e[6]=r=>s.snackbar=r),color:s.color,timeout:3e3,location:"top",rounded:"pill"},{default:l(()=>[c(b(s.message),1)]),_:1},8,["modelValue","color"])])}const E=_(P,[["render",q]]),W={name:"LoginView",components:{LoginFrom:H,RegisterFrom:E},data(){return{verifyImageUrl:"/api/verifyImage",user:T(),type:"登录",moveMessage:"没有账号，创建账号",showLogin:!0,message:"",showMessage:!1,webInfo:{}}},created(){this.webInfo=V().webInfo},methods:{userLogin(n){this.httpPost("/login",n,e=>{if(e.status===200){const d=e.data;this.user.setUserData(d);const u=this.$route.query.redirect;this.$router.push(u||"/")}else this.message=e.message,this.showMessage=!0})},register(n){this.httpPost("/register",n,e=>{e.status===200?(this.message="注册成功，即将为你跳转到登录页面！",this.showMessage=!0,this.moveRegister()):(this.message=e.message,this.showMessage=!0)})},moveRegister(){this.type==="登录"?this.type="注册":this.type="登录",this.moveMessage==="没有账号，创建账号"?this.moveMessage="已有账号，我要登录":this.moveMessage="没有账号，创建账号",this.showLogin=!this.showLogin},backHome(){this.$router.push("/")}}},G={class:"text-h4 font-weight-bold primary--text text-center"};function J(n,e,d,u,s,a){const i=t("v-btn"),m=t("v-row"),f=t("v-img"),v=t("v-card-item"),r=t("LoginFrom"),U=t("RegisterFrom"),x=t("v-card-text"),k=t("v-spacer"),C=t("v-card-actions"),I=t("v-card"),M=t("v-col"),L=t("v-snackbar"),R=t("v-container"),F=t("v-main");return p(),h(F,{class:"login-view"},{default:l(()=>[o(R,{"fill-height":""},{default:l(()=>[o(m,{justify:"center",align:"center"},{default:l(()=>[o(M,{cols:"12",sm:"8",md:"6",lg:"5"},{default:l(()=>[o(I,{class:"mx-auto elevation-6 rounded-lg",color:"surface"},{default:l(()=>[o(v,null,{default:l(()=>[o(m,{class:"mt-2 mb-2",justify:"start"},{default:l(()=>[o(i,{color:"primary",variant:"text","prepend-icon":"mdi-arrow-left",onClick:a.backHome},{default:l(()=>e[2]||(e[2]=[c(" 返回 ")])),_:1},8,["onClick"])]),_:1}),o(m,{justify:"center",class:"mb-4"},{default:l(()=>[o(f,{src:s.webInfo.logoUrl,height:"40",class:"mx-auto",contain:""},null,8,["src"])]),_:1}),o(m,{justify:"center",class:"mb-6"},{default:l(()=>[g("h1",G,b(s.webInfo.name)+" "+b(s.type),1)]),_:1})]),_:1}),o(x,null,{default:l(()=>[s.showLogin?(p(),h(r,{key:0,onLogin:a.userLogin},null,8,["onLogin"])):(p(),h(U,{key:1,onRegister:a.register},null,8,["onRegister"]))]),_:1}),o(C,{class:"px-6 mb-3"},{default:l(()=>[o(i,{variant:"text",color:"primary"},{default:l(()=>e[3]||(e[3]=[c(" 忘记密码 ")])),_:1}),o(k),o(i,{variant:"text",color:"primary",onClick:a.moveRegister},{default:l(()=>[c(b(s.moveMessage),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1}),o(L,{modelValue:s.showMessage,"onUpdate:modelValue":e[1]||(e[1]=y=>s.showMessage=y),timeout:3e3,color:"error",location:"top",rounded:"pill"},{actions:l(()=>[o(i,{color:"white",variant:"text",onClick:e[0]||(e[0]=y=>s.showMessage=!1)},{default:l(()=>e[4]||(e[4]=[c(" 关闭 ")])),_:1})]),default:l(()=>[c(b(s.message)+" ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})}const O=_(W,[["render",J]]);export{O as default};
